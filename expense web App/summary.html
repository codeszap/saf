<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Detailed Summary</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d6efd">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/theme.css" rel="stylesheet">
    <link rel="stylesheet" href="css/summary.css">
</head>

<body>

    <div class="container py-3" style="max-width:420px">
        <div class="d-flex align-items-center mb-4">
            <i class="bi bi-arrow-left fs-4 me-3" onclick="history.back()"
                style="cursor:pointer; color: var(--text-main);"></i>
            <h5 class="fw-bold mb-0">Financial Summary</h5>
        </div>

        <!-- Top Controls: Account Filter & Mode -->
        <div class="row g-2 mb-3">
            <div class="col-5">
                <select id="accountFilter" class="form-select shadow-sm"
                    style="border-radius:20px; font-size:13px; font-weight:600; border:1px solid var(--border-color); background:var(--bg-input); color:var(--text-main);"
                    onchange="applyFilters()">
                    <option value="ALL">ALL ACCOUNTS</option>
                    <option value="CASH">CASH</option>
                    <option value="BANK">BANK</option>
                    <option value="OTHER">OTHER</option>
                </select>
            </div>
            <div class="col-7">
                <div class="d-flex justify-content-between p-1 rounded-pill shadow-sm"
                    style="background: var(--bg-card); border: 1px solid var(--border-color);">
                    <button class="filter-btn active" id="btn-day" onclick="switchMode('day')"
                        style="flex:1; padding:4px 0;">Day</button>
                    <button class="filter-btn" id="btn-week" onclick="switchMode('week')"
                        style="flex:1; margin:0 3px; padding:4px 0;">Week</button>
                    <button class="filter-btn" id="btn-month" onclick="switchMode('month')"
                        style="flex:1; padding:4px 0;">Mth</button>
                    <button class="filter-btn" id="btn-custom" onclick="switchMode('custom')"
                        style="flex:1; padding:4px 0;">Cus</button>
                </div>
            </div>
        </div>

        <!-- Date Navigator -->
        <div id="dateNavigator"
            class="d-flex align-items-center justify-content-between mb-3 px-3 py-2 card shadow-sm flex-row"
            style="min-height:60px;">
            <button class="btn btn-light rounded-circle shadow-sm border p-0" onclick="changeDate(-1)"
                style="width:36px; height:36px; display:flex; align-items:center; justify-content:center;">
                <i class="bi bi-chevron-left"></i>
            </button>
            <span id="dateLabel" class="fw-bold text-primary mx-2 user-select-none text-center"
                style="font-size: 14px; line-height:1.2;">Loading...</span>
            <button class="btn btn-light rounded-circle shadow-sm border p-0" onclick="changeDate(1)"
                style="width:36px; height:36px; display:flex; align-items:center; justify-content:center;">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>

        <!-- Custom Date Range Inputs (Hidden by default) -->
        <div id="customDateInputs" class="d-none mb-3 card shadow-sm p-2 flex-row align-items-center gap-2">
            <input type="date" id="startDate" class="form-control form-control-sm fw-bold footer-input">
            <span class="fw-bold text-muted">-</span>
            <input type="date" id="endDate" class="form-control form-control-sm fw-bold footer-input">
            <button class="btn btn-primary btn-sm rounded-circle d-flex align-items-center justify-content-center"
                style="width:32px;height:32px;" onclick="applyCustomDate()">
                <i class="bi bi-check-lg"></i>
            </button>
        </div>

        <!-- Comparison Card -->
        <div id="comparisonCard" class="card shadow-sm mb-3 p-2 bg-light border-0" style="display:none;">
            <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted small fw-bold"><i class="bi bi-arrow-left-right me-1"></i>Vs Previous
                    Period</span>
                <span id="compLabel" class="badge bg-secondary">Loading...</span>
            </div>
        </div>

        <!-- View Tabs -->
        <ul class="nav nav-pills nav-fill mb-4 gap-2" role="tablist" style="font-size:14px; font-weight:600;">
            <li class="nav-item" role="presentation">
                <button class="nav-link active shadow-sm border" id="tab-summary" data-bs-toggle="pill"
                    data-bs-target="#view-summary" type="button" role="tab"
                    style="border-radius:12px;">Overview</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link shadow-sm border" id="tab-trends" data-bs-toggle="pill"
                    data-bs-target="#view-trends" type="button" role="tab" style="border-radius:12px;">Trends</button>
            </li>
        </ul>

        <div class="tab-content">
            <!-- VIEW 1: SUMMARY (Donuts + Lists) -->
            <div class="tab-pane fade show active" id="view-summary" role="tabpanel">

                <h6 class="section-title mb-2 px-1">Accounts Balance</h6>
                <div class="card shadow-sm p-3 mb-4">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="small fw-bold text-muted">CASH</span>
                        <span class="fw-bold" id="accCash">₹0.00</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="small fw-bold text-muted">BANK</span>
                        <span class="fw-bold" id="accBank">₹0.00</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="small fw-bold text-muted">OTHER</span>
                        <span class="fw-bold" id="accOther">₹0.00</span>
                    </div>
                </div>

                <h6 class="section-title mb-2 px-1">Income Categories</h6>
                <div id="incomeCategoryList" class="card shadow-sm mb-4">
                    <div class="text-center text-muted small py-3">No income recorded</div>
                </div>

                <h6 class="section-title mb-2 px-1">Expense Categories</h6>
                <div id="expenseCategoryList" class="card shadow-sm mb-5">
                    <div class="text-center text-muted small py-3">No expenses recorded</div>
                </div>
            </div> <!-- End Summary View -->

            <!-- VIEW 2: TRENDS (Bar Chart) -->
            <div class="tab-pane fade" id="view-trends" role="tabpanel">
                <div class="card shadow-sm p-3 mb-4">
                    <h6 class="fw-bold text-muted small mb-3 text-uppercase">Income vs Expense Trend</h6>
                    <div style="position: relative; height: 300px; width:100%;">
                        <canvas id="trendChartCanvas"></canvas>
                    </div>
                </div>
                <div class="text-center text-muted small">
                    <i class="bi bi-info-circle me-1"></i>Shows daily breakdown for the selected period.
                </div>
            </div>
        </div>
    </div>

    <!-- Drill-down Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1" aria-hidden="true" style="backdrop-filter: blur(5px);">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg" style="background: var(--bg-card); color: var(--text-main);">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title fw-bold" id="catModalTitle">Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        style="filter: invert(var(--invert-icon));"></button>
                </div>
                <div class="modal-body p-0" id="catModalBody">
                    <!-- Transactions go here -->
                </div>
                <div class="modal-footer border-top-0 justify-content-center p-2">
                    <button type="button" class="btn btn-sm btn-light rounded-pill px-4"
                        data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="drawer.js"></script>
    <script src="bottom-nav.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/summary.js"></script>
    <script src="js/pwa.js"></script>
</body>

</html>