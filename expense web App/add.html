<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Transaction</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-3" style="max-width:420px">
  <div class="d-flex align-items-center mb-3">
    <a href="index.html" class="btn btn-outline-secondary btn-sm me-2">‚Üê Back</a>
    <h5 class="mb-0 fw-bold">Add Transaction</h5>
  </div>

  <div class="card shadow-sm border-0">
    <div class="card-body">
      <form id="expenseForm">
        <div class="mb-3">
          <label class="form-label">Date</label>
          <input type="date" name="date" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Description</label>
          <input type="text" name="description" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Amount</label>
          <input type="number" name="amount" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Category</label>
          <input type="text" name="category" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Type</label>
          <select name="type" class="form-select" required>
            <option value="">Select type</option>
            <option value="Income">Income</option>
            <option value="Expense">Expense</option>
            <option value="Transfer">Transfer</option>
          </select>
        </div>
        <button type="submit" class="btn btn-success w-100">Save Transaction</button>
      </form>
      <div id="statusMsg" class="text-center mt-3 d-none"></div>
    </div>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxkuaCmPHJfIaEwudHRQakcvOy8aiv5jDeq8uT8Ma-k0aQkg6wgHOTTN1pDK0YnON6Wlw/exec"; // replace with doPost
const form = document.getElementById("expenseForm");
const statusMsg = document.getElementById("statusMsg");

// default today
const dateInput = form.querySelector('input[name="date"]');
dateInput.value = new Date().toISOString().split('T')[0];

// fill form if edit
const params = new URLSearchParams(window.location.search);
if(params.has('description')){
  form.date.value = params.get('date');
  form.description.value = params.get('description');
  form.amount.value = params.get('amount');
  form.category.value = params.get('category');
  form.type.value = params.get('type');
  form.insertAdjacentHTML('beforeend', `<input type="hidden" name="row" value="${params.get('row')}">`);
}

form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  statusMsg.className = "text-center mt-3 text-muted";
  statusMsg.textContent = "Saving...";
  statusMsg.classList.remove("d-none");

  const body = new URLSearchParams(new FormData(form));

  try{
    const res = await fetch(API_URL, { method:"POST", body });
    const result = await res.json();

    if(result.status==="Success"){
      statusMsg.className = "text-center mt-3 text-success";
      statusMsg.textContent = result.message;
      setTimeout(()=> window.location.href="index.html", 1000);
    } else {
      statusMsg.className = "text-center mt-3 text-danger";
      statusMsg.textContent = result.message||"Something went wrong";
    }
  }catch(err){
    statusMsg.className = "text-center mt-3 text-danger";
    statusMsg.textContent = "Network error. Try again.";
  }
});
</script>
</body>
</html>
