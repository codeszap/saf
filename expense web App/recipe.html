<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Recipe Planner - ProCheck</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/theme.css" rel="stylesheet">
    <link rel="stylesheet" href="css/recipe.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>

<body data-theme="light">

    <div class="recipe-container">

        <!-- DASHBOARD VIEW -->
        <div id="dashboardView">
            <header class="glass-header">
                <i class="bi bi-grid-fill fs-4 text-primary" style="cursor: pointer;" onclick="toggleDrawer(true)"></i>
                <div class="search-box">
                    <i class="bi bi-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Search dishes..." oninput="handleSearch()">
                </div>
                <i class="bi bi-bar-chart-fill fs-4 text-primary" style="cursor: pointer;"
                    onclick="openStatsModal()"></i>
            </header>

            <div id="recipeHistoryContainer">
                <!-- Grouped History rendered here -->
            </div>

            <div id="listEmptyState" class="empty-state hidden">
                <i class="bi bi-journal-text fs-1 mb-3 d-block"></i>
                <h6>No Recipes Found</h6>
                <p class="small">Tap + to add a dish</p>
            </div>

            <button class="fab" onclick="createNewRecipe()">
                <i class="bi bi-plus-lg"></i>
            </button>
        </div>

        <!-- EDITOR VIEW -->
        <div id="editorView" class="hidden">
            <header class="glass-header">
                <i class="bi bi-arrow-left fs-4" style="cursor: pointer;" onclick="showDashboard()"></i>
                <div id="activeDishTitle" class="fw-bold"
                    style="flex-grow:1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-left:10px;">
                    Recipe Editor</div>
                <div class="badge bg-primary rounded-pill py-2 px-3">
                    <span style="font-size: 0.7rem;">₹</span><span id="currentTotalCost">0</span>
                </div>
            </header>

            <div class="section-header">
                <span class="section-header-title">Ingredients Checklist</span>
                <button class="btn btn-sm btn-outline-secondary rounded-pill px-3" style="font-size: 0.75rem;"
                    onclick="openRenameModal()">Rename</button>
            </div>

            <div id="ingredientListBox" class="list-group-box"></div>

            <div id="editorEmptyState" class="empty-state hidden">
                <i class="bi bi-basket3 fs-2 d-block mb-3"></i>
                <p class="small">No items yet.<br>Tap the + button to add ingredients.</p>
            </div>

            <div class="mt-4 text-center">
                <button class="btn btn-link text-danger text-decoration-none btn-sm" onclick="deleteCurrentRecipe()">
                    <i class="bi bi-trash3 me-1"></i>Delete Dish
                </button>
            </div>

            <button class="fab" onclick="openAddIngredientModal()">
                <i class="bi bi-plus-lg"></i>
            </button>
        </div>

        <!-- REPORT VIEW (Full Screen) -->
        <div id="reportView" class="hidden">
            <header class="glass-header">
                <i class="bi bi-arrow-left fs-4" style="cursor: pointer;" onclick="showDashboard()"></i>
                <div class="fw-bold" style="flex-grow:1; margin-left:10px;">Overall Report</div>
                <i class="bi bi-grid-fill fs-4 text-primary" style="cursor: pointer;" onclick="toggleDrawer(true)"></i>
            </header>

            <!-- Tabs in Page -->
            <ul class="nav nav-pills w-100 bg-light-subtle rounded-pill p-1 mb-3" id="reportTabs" role="tablist"
                style="border: 1px solid var(--border-color);">
                <li class="nav-item flex-fill" role="presentation">
                    <button class="nav-link active rounded-pill py-2 w-100 small fw-bold" id="summary-tab"
                        data-bs-toggle="pill" data-bs-target="#summaryPane" type="button">SUMMARY</button>
                </li>
                <li class="nav-item flex-fill" role="presentation">
                    <button class="nav-link rounded-pill py-2 w-100 small fw-bold" id="timeline-tab"
                        data-bs-toggle="pill" data-bs-target="#timelinePane" type="button"
                        onclick="renderTimeline()">TIMELINE</button>
                </li>
            </ul>

            <div class="tab-content" id="reportTabContent">
                <div class="tab-pane fade show active" id="summaryPane" role="tabpanel">
                    <div id="reportStatsList" class="mt-2">
                        <!-- Stats rows -->
                    </div>
                </div>
                <div class="tab-pane fade" id="timelinePane" role="tabpanel">
                    <div id="reportTimelineList" class="mt-2">
                        <!-- History rows -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Add/Edit Ingredient -->
    <div class="modal fade" id="ingredientModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="ingModalTitle">Add Ingredients</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="addFeedback" class="text-success small fw-bold mb-2 hidden"><i
                            class="bi bi-check-circle-fill me-1"></i>Item added!</div>
                    <input type="text" id="ingName" class="modern-input" placeholder="Item Name">
                    <input type="number" id="ingPrice" class="modern-input" placeholder="Price (Optional ₹)">
                    <textarea id="ingDesc" class="modern-input" placeholder="Description / Notes (Optional)"
                        rows="2"></textarea>

                    <!-- Buttons Row -->
                    <div id="ingModalFooter" class="mt-3"></div>

                    <!-- Recent Preview -->
                    <div id="modalPreviewSection" class="mt-3 hidden">
                        <div class="small fw-bold text-muted mb-2 border-top pt-2">Recently Added:</div>
                        <div id="modalPreviewList" class="small"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Rename Dish -->
    <div class="modal fade" id="renameDishModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Rename Dish</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="dishNameInput" class="modern-input" placeholder="New Dish Name">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary w-100 rounded-pill py-2 fw-bold"
                        onclick="saveNewName()">SAVE CHANGES</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Ingredient Detail -->
    <div class="modal fade" id="ingDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title fw-bold" id="detailModalTitle">Ingredient Name</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body pt-0">
                    <div id="detailModalPrice" class="text-primary fw-bold mb-3"></div>
                    <div id="detailModalDesc" class="text-muted small" style="line-height: 1.6;"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Hidden Date Picker for Swipe -->
    <input type="date" id="hiddenDatePicker" class="hidden" onchange="assignCustomDate(this.value)">

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="drawer.js"></script>
    <script src="bottom-nav.js"></script>
    <script src="js/recipe.js"></script>
    <script src="js/pwa.js"></script>
</body>

</html>