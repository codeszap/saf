<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Form with Table, Image & Context Menu</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .form-container {
      max-width: 600px;
      margin: auto;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .form-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 15px;
    }
    label {
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="number"],
    input[type="month"],
    input[type="date"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    button {
      flex: 1;
      padding: 10px;
      border: none;
      color: #fff;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
    }
    .add-btn { background-color: green; }
    .clear-btn { background-color: red; }
    .image-btn { background-color: #007bff; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #f0f0f0;
    }
    tfoot td {
      font-weight: bold;
      background-color: #f9f9f9;
      text-align: center;
    }
    #monthLabel {
      text-align: center;
      margin-top: 15px;
      font-size: 20px;
      font-weight: bold;
      display: none;
      color: #444;
    }
    input[type="checkbox"]:disabled {
      cursor: not-allowed;
    }
    .context-menu {
      position: absolute;
      display: none;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 999;
    }
    .context-menu button {
      display: block;
      width: 100%;
      padding: 10px;
      border: none;
      background: none;
      text-align: left;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
    }
    .context-menu button:hover {
      background-color: #007bff;
      color: #fff;
    }
  </style>
</head>
<body>

<div class="form-container">
  <div class="form-group">
    <label for="month">Month</label>
    <input type="month" id="month" />
  </div>
  <div class="form-group">
    <label for="newDate">Date</label>
    <input type="date" id="newDate" />
  </div>
  <div class="form-group">
    <label for="name">Name</label>
    <input type="text" id="name" placeholder="Enter name" />
  </div>
  <div class="form-group">
    <label for="amount">Amount</label>
    <input type="number" id="amount" placeholder="Enter amount" />
  </div>
  <div class="checkbox-group">
    <input type="checkbox" id="active" checked />
    <label for="active">Active</label>
  </div>
  <div class="button-row">
    <button class="add-btn" onclick="addToTable()">Add</button>
    <button class="clear-btn" onclick="confirmClear()">Clear</button>
    <button class="image-btn" onclick="captureImage()">üì∏ Get Image</button>
  </div>

  <div id="captureArea" style="padding: 20px; background: white;">
    <h2 id="monthLabel"></h2>
    <table id="dataTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Name</th>
          <th>Amount</th>
          <th>Active</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="4">
            <strong>Total:</strong> ‚Çπ<span id="totalAmount">0</span> |
            <strong>Pay:</strong> ‚Çπ<span id="activeAmount">0</span> |
            <strong>Pend:</strong> ‚Çπ<span id="inactiveAmount">0</span>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<!-- Context Menu -->
<div id="contextMenu" class="context-menu">
  <button onclick="editRow()">üìù Edit</button>
  <button onclick="deleteRow()">üóëÔ∏è Delete</button>
  <button onclick="hideContextMenu()">‚ùå Cancel</button>
</div>

<script>
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, '0');
  const dd = String(today.getDate()).padStart(2, '0');
  document.getElementById('month').value = `${yyyy}-${mm}`;
  document.getElementById('newDate').value = `${yyyy}-${mm}-${dd}`;

  let selectedRow = null;

  function addToTable() {
    const name = document.getElementById('name').value.trim();
    const amount = document.getElementById('amount').value.trim();
    const active = document.getElementById('active').checked;
    const date = document.getElementById('newDate').value;

    if (!name || !amount || !date) {
      alert("Please fill all fields");
      return;
    }

    // Check for duplicates
    const rows = document.querySelectorAll('#dataTable tbody tr');
    for (let row of rows) {
      if (
        row.cells[0].textContent === formatDate(date) &&
        row.cells[1].textContent.toLowerCase() === name.toLowerCase() &&
        row.cells[2].textContent === amount
      ) {
        alert("Duplicate entry not allowed");
        return;
      }
    }

    const table = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
    const newRow = table.insertRow();

    const dateCell = newRow.insertCell(0);
    const nameCell = newRow.insertCell(1);
    const amountCell = newRow.insertCell(2);
    const activeCell = newRow.insertCell(3);

    dateCell.textContent = formatDate(date);
    nameCell.textContent = name;
    amountCell.textContent = amount;

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.disabled = true;
    checkbox.checked = active;
    activeCell.appendChild(checkbox);

    newRow.addEventListener('contextmenu', function (e) {
      e.preventDefault();
      selectedRow = newRow;
      showContextMenu(e.pageX, e.pageY);
    });

    clearForm();
    updateTotal();
    showMonthLabel();
    saveToSession();
    showToast("‚úÖ Added successfully!");
  }

  function formatDate(dateStr) {
    const parts = dateStr.split("-");
    return `${parts[2]}-${parts[1]}-${parts[0]}`;
  }

  function clearForm() {
    document.getElementById('name').value = '';
    document.getElementById('amount').value = '';
    document.getElementById('active').checked = true;
    document.getElementById('newDate').value = `${yyyy}-${mm}-${dd}`;
  }

  function updateTotal() {
    let total = 0, pay = 0, pend = 0;
    const rows = document.querySelectorAll('#dataTable tbody tr');
    rows.forEach(row => {
      const amt = parseFloat(row.cells[2].textContent);
      const active = row.cells[3].querySelector('input').checked;
      total += amt;
      active ? pay += amt : pend += amt;
    });
    document.getElementById('totalAmount').textContent = total;
    document.getElementById('activeAmount').textContent = pay;
    document.getElementById('inactiveAmount').textContent = pend;
  }

  function showMonthLabel() {
    const [year, month] = document.getElementById('month').value.split("-");
    const monthName = new Date(year, month - 1).toLocaleString('default', { month: 'long' });
    const label = document.getElementById('monthLabel');
    label.textContent = `${monthName} Month Schedule`;
    label.style.display = 'block';
  }

  function captureImage() {
    const element = document.getElementById("captureArea");
    html2canvas(element, {
      backgroundColor: null,
      scale: 2,
      scrollY: -window.scrollY
    }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'table-screenshot.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  }

  function showContextMenu(x, y) {
    const menu = document.getElementById('contextMenu');
    menu.style.top = `${y}px`;
    menu.style.left = `${x}px`;
    menu.style.display = 'block';
  }

  function hideContextMenu() {
    document.getElementById('contextMenu').style.display = 'none';
  }

  document.addEventListener('click', hideContextMenu);

  function editRow() {
    if (!selectedRow) return;
    const [d, m, y] = selectedRow.cells[0].textContent.split("-");
    document.getElementById('newDate').value = `${y}-${m}-${d}`;
    document.getElementById('name').value = selectedRow.cells[1].textContent;
    document.getElementById('amount').value = selectedRow.cells[2].textContent;
    document.getElementById('active').checked = selectedRow.cells[3].querySelector('input').checked;
    selectedRow.remove();
    updateTotal();
    saveToSession();
    hideContextMenu();
  }

  function deleteRow() {
    if (selectedRow) {
      selectedRow.remove();
      updateTotal();
      saveToSession();
    }
    hideContextMenu();
  }

  function confirmClear() {
    if (confirm("Are you sure you want to clear everything?")) {
      document.querySelector('#dataTable tbody').innerHTML = '';
      document.getElementById('monthLabel').style.display = 'none';
      updateTotal();
      sessionStorage.clear();
    }
  }

  function showToast(msg) {
    alert(msg); // You can replace with custom toast
  }

  function saveToSession() {
    const rows = Array.from(document.querySelectorAll('#dataTable tbody tr')).map(row => ({
      date: row.cells[0].textContent,
      name: row.cells[1].textContent,
      amount: row.cells[2].textContent,
      active: row.cells[3].querySelector('input').checked
    }));
    sessionStorage.setItem('dataRows', JSON.stringify(rows));
  }

  function loadFromSession() {
    const rows = JSON.parse(sessionStorage.getItem('dataRows') || '[]');
    rows.forEach(data => {
      const table = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
      const newRow = table.insertRow();
      newRow.insertCell(0).textContent = data.date;
      newRow.insertCell(1).textContent = data.name;
      newRow.insertCell(2).textContent = data.amount;
      const activeCell = newRow.insertCell(3);
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.disabled = true;
      checkbox.checked = data.active;
      activeCell.appendChild(checkbox);

      newRow.addEventListener('contextmenu', function (e) {
        e.preventDefault();
        selectedRow = newRow;
        showContextMenu(e.pageX, e.pageY);
      });
    });
    updateTotal();
    showMonthLabel();
  }

  window.onload = loadFromSession;
</script>

</body>
</html>
